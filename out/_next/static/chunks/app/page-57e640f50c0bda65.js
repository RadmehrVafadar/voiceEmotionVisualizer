(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3792:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var a=n(5155),r=n(2115),o=n(3264),i=n(7431),l=n(5416),s=n(1077);function d(){let e=(0,r.useRef)(null),[t,n]=(0,r.useState)(null),[d,m]=(0,r.useState)({x:0,y:0}),[c,u]=(0,r.useState)(!1),f=(0,r.useRef)(null),p=(0,r.useRef)(null),h=(0,r.useRef)(null);(0,r.useEffect)(()=>{let t,n=e.current.clientWidth,a=e.current.clientHeight,r=new o.Z58;r.background=new o.Q1f(0);let s=new o.ubm(60,n/a,.1,2e3);s.position.set(0,0,200);let d=new i.JeP({antialias:!0});d.setSize(n,a),d.shadowMap.enabled=!0,e.current.appendChild(d.domElement);let w=new l.N(s,d.domElement);w.enableDamping=!0,w.dampingFactor=.1,w.minDistance=50,w.maxDistance=500,w.enablePan=!1,w.target.set(0,0,0),w.rotateSpeed=.5,w.autoRotate=!0,w.autoRotateSpeed=.5,r.add(new o.dth(8421504,1052688,1));let y=new o.ZyN(0xffffff,.5);y.position.set(0,1,1),r.add(y);let g=new Float32Array(27e3),v=new Float32Array(27e3),E=new Float32Array(27e3),b=new o.Q1f;for(let e=0;e<9e3;e++){let t=o.cj9.randFloat(0,2*Math.PI),n=Math.acos(o.cj9.randFloat(-1,1)),a=Math.sin(n)*Math.cos(t),r=Math.sin(n)*Math.sin(t),i=Math.cos(n);g.set([a,r,i],3*e),v.set([50*a,50*r,50*i],3*e),b.setHSL(n/Math.PI,.7,.5),E.set([b.r,b.g,b.b],3*e)}let x=new o.LoY;x.setAttribute("position",new o.THS(v,3)),x.setAttribute("color",new o.THS(E,3));let M=new o.BH$({size:2,vertexColors:!0,transparent:!0,opacity:.9,depthWrite:!1}),A=new o.ONl(x,M);r.add(A),new o.tBo,new o.I9Y;let S=new o.Pq0;new o.Pq0;let L=document.createElement("div");L.style.position="absolute",L.style.width="30px",L.style.height="30px",L.style.borderRadius="50%",L.style.backgroundColor="rgba(255, 0, 0, 0.8)",L.style.pointerEvents="none",L.style.transform="translate(-50%, -50%)",L.style.zIndex="1000",L.style.transition="transform 0.1s ease-out",e.current.appendChild(L);let j=e=>{let t=d.domElement.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top;m({x:n,y:a}),L.style.left="".concat(n,"px"),L.style.top="".concat(a,"px");let r=n/t.width*2-1,i=-(2*(a/t.height))+1,l=new o.Pq0(r,i,.5);l.unproject(s);let c=l.sub(s.position).normalize(),u=s.position.clone().add(c.multiplyScalar(200));S.copy(u)};d.domElement.addEventListener("mousemove",j),d.domElement.addEventListener("mousedown",()=>{u(!0),L.style.transform="translate(-50%, -50%) scale(1.5)"}),d.domElement.addEventListener("mouseup",()=>{u(!1),L.style.transform="translate(-50%, -50%) scale(1)"}),d.domElement.addEventListener("mouseleave",()=>{u(!1),L.style.transform="translate(-50%, -50%) scale(1)"});let C=()=>{w.update();let e=f.current,n=p.current,a=h.current;if(e&&n&&a){e.getByteFrequencyData(n),e.getByteTimeDomainData(a);let t=0;for(let e of a)t+=Math.abs(e-128);let r=t/a.length/128,i=0,l=0;for(let e=0;e<n.length;e++)i+=n[e],l+=n[e]*e;let s=i>0?l/i/(n.length-1):0,d=x.attributes.position,m=x.attributes.color,u=.001*performance.now();for(let e=0;e<9e3;e++){let t=3*e,n=g[t],a=g[t+1],i=g[t+2],l=50+100*r+(Math.random()-.1)*10,f=n*l,p=a*l,h=i*l,w=(s+(Math.random()-.5)*.4+.1*Math.sin(2*u))%1,y=.5+.5*r,v=.3+.4*r,E=w,x=y,M=v,A=new o.Pq0(f,p,h),L=A.distanceTo(S);if(L<100){let e=1-L/100,t=15*Math.pow(e,2),n=new o.Pq0().subVectors(c?S:A,c?A:S).normalize();f+=n.x*t*(1+(Math.random()-.5)*.2),p+=n.y*t*(1+(Math.random()-.5)*.2),h+=n.z*t*(1+(Math.random()-.5)*.2);let a=.6*!c;E=o.cj9.lerp(w,a,e),x=o.cj9.clamp(y+.3*e,0,1),M=o.cj9.clamp(v+.2*e,0,1)}b.setHSL(E,x,M),m.setXYZ(e,b.r,b.g,b.b),d.setXYZ(e,f,p,h)}d.needsUpdate=!0,m.needsUpdate=!0}A.rotation.y+=0,d.render(r,s),t=requestAnimationFrame(C)};return C(),window.addEventListener("resize",()=>{let t=e.current.clientWidth,n=e.current.clientHeight;s.aspect=t/n,s.updateProjectionMatrix(),d.setSize(t,n)}),()=>{var n;cancelAnimationFrame(t),d.dispose(),r.clear(),null==(n=e.current)||n.removeChild(L),d.domElement.removeEventListener("mousemove",j),d.domElement.removeEventListener("mousedown",()=>u(!0)),d.domElement.removeEventListener("mouseup",()=>u(!1)),d.domElement.removeEventListener("mouseleave",()=>u(!1))}},[]),(0,r.useEffect)(()=>{if(!t)return;let e=new(window.AudioContext||window.AudioContext),n=e.createAnalyser();n.fftSize=2048,n.smoothingTimeConstant=.8;let a=new Uint8Array(n.frequencyBinCount),r=new Uint8Array(n.fftSize);n.connect(e.destination),f.current=n,p.current=a,h.current=r;let o=t=>{let a=e.createBufferSource();a.buffer=t,a.connect(n),a.start()},i=async()=>{let a=await t.arrayBuffer(),r=new s.Midi(a),o=e.currentTime+.3;r.tracks.forEach(t=>t.notes.forEach(t=>{let a=e.createOscillator();a.type="sine",a.frequency.value=440*Math.pow(2,(t.midi-69)/12);let r=e.createGain();a.connect(r).connect(n),r.gain.setValueAtTime(0,o+t.time),r.gain.linearRampToValueAtTime(1,o+t.time+.01),r.gain.exponentialRampToValueAtTime(.001,o+t.time+t.duration),a.start(o+t.time),a.stop(o+t.time+t.duration+.1)}))};return(async()=>{if(await e.resume(),/\.(mid|midi)$/i.test(t.name))await i();else if(/\.mp3$/i.test(t.name)){let n=await t.arrayBuffer();o(await e.decodeAudioData(n))}})(),()=>{e.close()}},[t]);let w=e=>{e.preventDefault(),e.stopPropagation()};return(0,a.jsxs)("main",{style:{margin:0,height:"100vh",overflow:"hidden",position:"relative"},children:[(0,a.jsx)("div",{onDragEnter:w,onDragOver:w,onDragLeave:w,onDrop:e=>{w(e);let t=e.dataTransfer.files[0];t&&/\.(mid|midi|mp3)$/i.test(t.name)&&n(t)},style:{position:"absolute",top:0,left:0,right:0,zIndex:1,padding:"1rem",textAlign:"center",background:"rgba(0,0,0,0.6)",color:"#fff"},children:t?(0,a.jsxs)("span",{style:{color:"#0f0"},children:["Loaded: ",t.name]}):(0,a.jsxs)("span",{style:{color:"#ff0"},children:["Drag & drop .mid/.mp3 here or ",(0,a.jsx)("input",{type:"file",accept:".mid,.midi,.mp3",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&/\.(mid|midi|mp3)$/i.test(a.name)&&n(a)},style:{color:"#ff0"}})]})}),(0,a.jsx)("div",{ref:e,style:{width:"100%",height:"100%"}})]})}},9065:(e,t,n)=>{Promise.resolve().then(n.bind(n,3792))}},e=>{var t=t=>e(e.s=t);e.O(0,[367,831,868,441,684,358],()=>t(9065)),_N_E=e.O()}]);